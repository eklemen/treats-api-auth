{"version":3,"sources":["../../server/controllers/auth_controller.js"],"names":["jwt","require","tokenForUser","user","timestamp","Date","getTime","encode","sub","id","iat","secret","signin","req","res","next","send","token","user_id","signup","body","email","password","status","json","error","findOne","err","existingUser","save","_id","logout","getUsers","find","then","success","data","users","catch","message","authController"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;AACA,IAAMA,MAAMC,QAAQ,YAAR,CAAZ;;AAEA,SAASC,YAAT,CAAsBC,IAAtB,EAA4B;AACxB,QAAMC,YAAY,IAAIC,IAAJ,GAAWC,OAAX,EAAlB;AACA,WAAON,IAAIO,MAAJ,CAAW;AACdC,aAAKL,KAAKM,EADI;AAEdC,aAAKN;AAFS,KAAX,EAGJ,iBAAOO,MAHH,CAAP;AAIH;;AAED,SAASC,MAAT,CAAgBC,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AAAA,QACpBZ,IADoB,GACXU,GADW,CACpBV,IADoB;;AAE5BW,QAAIE,IAAJ,CAAS,EAAEC,OAAOf,aAAaC,IAAb,CAAT,EAA6Be,SAASf,KAAKM,EAA3C,EAAT;AACH;;AAED,SAASU,MAAT,CAAgBN,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAA+B;AAAA,oBAMvBF,GANuB,CAEvBO,IAFuB;AAAA,QAGnBC,KAHmB,aAGnBA,KAHmB;AAAA,QAInBC,QAJmB,aAInBA,QAJmB;;;AAQ3B,QAAG,CAACD,KAAD,IAAU,CAACC,QAAd,EAAwB;AACpB,eAAOR,IAAIS,MAAJ,CAAW,GAAX,EACFC,IADE,CACG,EAACC,OAAO,qCAAR,EADH,CAAP;AAEH;;AAED;AACA,mBAAKC,OAAL,CAAa,EAAEL,YAAF,EAAb,EAAwB,UAACM,GAAD,EAAMC,YAAN,EAAuB;AAC3C,YAAGD,GAAH,EAAQ,OAAOZ,KAAKY,GAAL,CAAP;AACR,YAAGC,YAAH,EAAiB;AACb,mBAAOd,IAAIS,MAAJ,CAAW,GAAX,EACFC,IADE,CACG,EAAEC,OAAO,+BAAT,EADH,CAAP;AAEH;AACD,YAAMtB,OAAO,mBAAS,EAAEkB,YAAF,EAASC,kBAAT,EAAT,CAAb;AACAnB,aAAK0B,IAAL,CAAW,UAASF,GAAT,EAAc;AACrB,gBAAGA,GAAH,EAAQ,OAAOZ,KAAKY,GAAL,CAAP;AACRb,gBAAIU,IAAJ,CAAS;AACLN,yBAASf,KAAK2B,GADT;AAELb,uBAAOf,aAAaC,IAAb;AAFF,aAAT;AAIH,SAND;AAOH,KAdD;AAeH;;AAED,SAAS4B,MAAT,CAAgBlB,GAAhB,EAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AAC5BF,QAAIkB,MAAJ;AACAjB,QAAIU,IAAJ,CAAS;AACLD,gBAAQ;AADH,KAAT;AAGH;;AAED,SAASS,QAAT,CAAkBnB,GAAlB,EAAuBC,GAAvB,EAA4BC,IAA5B,EAAkC;AAC9B,mBAAKkB,IAAL,CAAU,EAAV,EAAc,EAAEX,UAAU,CAAZ,EAAd,EACKY,IADL,CACW,iBAAS;AACZ,eAAOpB,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBW,qBAAS,IADe;AAExBC,kBAAMC;AAFkB,SAArB,CAAP;AAIH,KANL,EAMOC,KANP,CAMc,eAAO;AACb,eAAOxB,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACxBe,qBAASZ;AADe,SAArB,CAAP;AAGP,KAVD;AAWH;;AAED,IAAMa,iBAAiB;AACnBrB,kBADmB;AAEnBP,kBAFmB;AAGnBmB,kBAHmB;AAInBC;AAJmB,CAAvB;;kBAOeQ,c","file":"auth_controller.js","sourcesContent":["import User from '../models/user';\nimport config from '../config';\nconst jwt = require('jwt-simple');\n\nfunction tokenForUser(user) {\n    const timestamp = new Date().getTime();\n    return jwt.encode({\n        sub: user.id,\n        iat: timestamp\n    }, config.secret);\n}\n\nfunction signin(req, res, next) {\n    const { user } = req;\n    res.send({ token: tokenForUser(user), user_id: user.id });\n}\n\nfunction signup(req, res, next){\n    const {\n        body: {\n            email,\n            password\n        }\n    } = req;\n\n    if(!email || !password) {\n        return res.status(422)\n            .json({error: 'You must provide email and password' });\n    }\n\n    // Check if user already exists, throw error if true\n    User.findOne({ email }, (err, existingUser) => {\n        if(err) return next(err);\n        if(existingUser) {\n            return res.status(422)\n                .json({ error: 'This email is already in use.'});\n        }\n        const user = new User({ email, password });\n        user.save( function(err) {\n            if(err) return next(err);\n            res.json({\n                user_id: user._id,\n                token: tokenForUser(user)\n            });\n        })\n    })\n}\n\nfunction logout(req, res, next) {\n    req.logout();\n    res.json({\n        status: 'logged out'\n    });\n}\n\nfunction getUsers(req, res, next) {\n    User.find({}, { password: 0 })\n        .then( users => {\n            return res.status(200).json({\n                success: true,\n                data: users\n            })\n        }).catch( err => {\n            return res.status(500).json({\n                message: err\n            })\n    })\n}\n\nconst authController = {\n    signup,\n    signin,\n    logout,\n    getUsers\n};\n\nexport default authController;\n"]}